<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1.0,user-scalable=0">
<meta name="format-detection" content="telephone=no">
<title>≡0v0) { ﾊﾄｶﾞﾃﾞﾙﾖ</title>
<style type="text/css"><!--
@font-face{font-family:"emj";src:local("Apple Color Emoji"),local("Noto Color Emoji");unicode-range:U+2600/*☀*/,U+263A/*☺*/,U+2764/*❤*/;}
body{color:white;background-color:black;width:100%;margin:0 auto; max-width:340px;}
*{-webkit-appearance:none;font:13px sans-serif;border-radius:0;}
#cn,#pn{width:80%;margin:0 auto;position:relative}
#pn,#vw{display:none;line-height:125%;}
textarea{color:white;background-color:#212121;letter-spacing:1px;width:100%;margin:0 0 2px;padding:3px 5px;resize:none;line-break:anywhere;}
#pr{font:13px/125% "emj","NasuM",monospace,monospace;}
#vw{color:white;background-color:#313131;position:absolute;padding:1em;z-index:9;}
p{font-size:15px;margin:24px 0;padding:0;line-break:anywhere;}
button,input,select{color:white;background-color:#216651;height:26px;vertical-align:middle;margin:0;padding:0;border-style:solid;border-width:0 0 1px 1px;border-color:black;}
button,input[type="number"],input[type="color"]{text-align:center;width:20%;}
input[type="checkbox"]{width:16px;height:16px;}
input[type="checkbox"]:checked{background-color:white;border:3px solid #216651;}
select,option{width:80%;padding:0 5px;}
h1{color:c7ffa9;background-color:#111;text-align:center;margin:0;padding:3px;position:fixed;top:0;left:0;width:100%;}
h1 button{width:26px;height:26px;}
.hm{color:#212151;background-color:#c9c951;position:absolute;top:0;left:0;text-align:center;visibility:hidden;transform:rotate(90deg);transform-origin:0 0;}
.hm.o{visibility:visible;}
.mes{color:#f1f1f1;background-color:#216651;text-align:center;width:50%;border-radius:1em;box-shadow:0 0 9px 5px;position:fixed;top:27%;left:25%;padding:7px 0;visibility:hidden;transform-origin:0 0;opacity:0;transition:opacity 250ms, visibility 0s ease 250ms;z-index:8;}
.mes.age{visibility:visible;opacity:1;transition-delay:0s;}
#swg{display:none;}
#sw{font:12px sans-serif;}
--></style>
<link rel="manifest" href="m.json">
<link rel="apple-touch-icon" href="apple-touch-icon.png">
<link rel="stylesheet" type="text/css" href="wf.css">
</head><body ondblclick=";">
<form>
<div id="vw"></div>
<div id="me" class="mes"></div>
<textarea rows=12 cols=17 name="pr" id="pr" class="pr" onchange="bu()"></textarea>
<div id="cn"><button type=button onclick="si()">⤵</button><button type=button onclick="a()">「</button><button type=button onclick="u()">↑</button><button type=button onclick="m()">≫</button><button type=button onclick="o()">▼</button><button type=button onclick="gi()">⤴</button><button type=button onclick="l()">←</button><button type=button onclick="b()">～</button><button type=button onclick="g()">→</button><button type=button onclick="c()">■</button><button type=button onclick="h()">Φ</button><button type=button onclick="t()">≪</button><button type=button onclick="d()">↓</button><button type=button onclick="z()">」</button><button type=button onclick="v()">ｖ</button><span id="swg"><select  name="swl" id="swl" class="swl"></select><button type=button onclick="i()">＋</button></span><span id="bm" class="hm">範囲選択</span></div>
<div id="pn"><button type=button onclick="o()">切替▼</button>　<button type=button onclick="st()">設定</button>
<br>
<br><input type="number" name="cr" id="cr" class="cr" max=20 min=5 value=12>テキストエリア高さ(行)
<br><input type="number" name="ft" id="ft" class="ft" max=39 min=8 value=13>フォントサイズ(px)
<br><input type="number" name="ls" id="ls" class="ls" max=9 min=0 value=1>字間(px)
<br><input type="number" name="lh" id="lh" class="lh" max=200 min=0 value=125>行間(%)
<br><input type="color" name="fc" id="fc" class="fc" value="#ffffff">文字色
<br><input type="color" name="bc" id="bc" class="bc" value="#212121">背景色
<br><input type="number" name="bh" id="bh" class="bh" max=45 min=11 value=26>ボタン高さ(px)
<br>
<br><label><input type="checkbox" name="sc" id="sc" class="sc">定型文を使用</label>
<br><textarea rows=3 cols=17 name="sw" id="sw" class="sw" placeholder="1行1定型文/改行を含める場合は『\n』で置換"></textarea>
<br>
<br><button type=button onclick="o()">切替▼</button>　<button type=button onclick="st()">設定</button>
<br>
<br>ﾊｰﾄが出るﾃｷｽﾄｴﾘｱ
<br>「ﾊﾄﾃﾞﾘｬｰ」
<br>2022_0426_2059
<br>
<br>-動作確認：iOS15.4.1 + Safari
<br>-ホーム画面に追加すると単独アプリっぽく使える気がする
<br>
<br>!!!不意のデータクリアに備えて別途保存を推奨
<br>
<br>-textareaのonchangeで自動保存→リロード時に復元
<br>-[手動保存/手動復元]と[自動保存/リロード復元]は別データ
<br>-データ保持はブラウザのlocalStorageを使用
<br>
<br>-ｶﾝﾑﾘﾊﾞﾄﾁｬﾝｶﾜｲｲﾖ
<br>
<br>
<br>
<br>
<br>webフォント(約3MB)の使用を<button type=button name="wf" id="wf" class="wf" onclick="fl()">開始</button>
<br>
<br>キャッシュを破棄してページを<button type=button onclick="location.reload(true)">再読込</button>
<br>
<br>ローカルストレージを<button type=button onclick="adel()">全削除</button>
<br>※他サイトのデータは消えません</div>
</form>

<script>//<!--

function fl() { //……webフォント適用切り替え
	s = document.getElementById("wf").textContent;
	if(s =="終了"){
		p.style.fontFamily = '"emj","NasuM",monospace,monospace';
		document.getElementById("wf").textContent = "開始";
		localStorage.setItem('wfl',0);
		mp("終了しました");
	}else{
		p.style.fontFamily = '"emj","webnasm"';
		document.getElementById("wf").textContent = "終了";
		localStorage.setItem('wfl',1);
		mp("開始しました");
	}
}

function mp(s) { //……メッセージポップ
	document.getElementById("me").innerHTML = s;
	document.getElementById("me").classList.toggle("age");
	setTimeout(function() {
		document.getElementById("me").classList.toggle("age");
	},1000);
}

function adel() { //……ストレージ全削除
	if(window.confirm("本当に全削除しますか？")){
		localStorage.clear();
		mp("削除しました");
	}
}

function b() { //……範囲選択モード
	if(bb){
		bb = 0;
	}else{
		bb = 1;
	}
	document.getElementById("bm").classList.toggle("o");
}

function st() { //……設定変更
	s = document.getElementById("cr").value; //テキストエリア高さ(行)
	p.rows = s;
	localStorage.setItem('prows',s);
	s = document.getElementById("ft").value; //フォントサイズ(px)
	p.style.fontSize = s + "px";
	localStorage.setItem('pfs',s);
	pw = s - 0;
	s = document.getElementById("ls").value; //字間(px)
	p.style.letterSpacing = s + "px";
	localStorage.setItem('pls',s);
	pw = pw + (s - 0);
	s = document.getElementById("lh").value; //行間(%)
	p.style.lineHeight = s + "%";
	localStorage.setItem('plh',s);
	s = document.getElementById("fc").value; //文字色
	p.style.color = s;
	localStorage.setItem('pfc',s);
	s = document.getElementById("bc").value; //背景色
	p.style.backgroundColor = s;
	localStorage.setItem('pbc',s);
	s = document.getElementById("bh").value; //ボタン高さ(px)
	for (s1 = 0; s1 < 16; s1++) {
		document.getElementsByTagName("button")[s1].style.height = s + "px";
	}
	r.style.height = s + "px";
	localStorage.setItem('pbh',s);
	
	s = pw;
	pw = p.clientWidth;
	pw = Math.floor(pw / s); //1行の文字数（全角）
	
	s = document.getElementById("sc").checked; //定型文スイッチ
	if(s){
		document.getElementById("swg").style.display = "inline";
	}else{
		document.getElementById("swg").style.display = "none";
	}
	localStorage.setItem('psc',s);
	s = document.getElementById("sw").value; //定型文内容
	localStorage.setItem('psw',s);
	s = s.replace(/</g,"&lt;");
	s = s.replace(/>/g,"&gt;");
	s = s.replace(/^(.+)$/gm,"<option>$1</option>");
	r.innerHTML = s;

	mp("設定しました");
}

function i() { //……定型文挿入
	s = r.value;
	if(s != ""){
		s = s.replace(/&lt;/g,"<");
		s = s.replace(/&gt;/g,">");
		s1 = s.replace(/\\n/g,"\n");
		s = p.value;
		q = p.selectionEnd;
		p.value = s.slice(0,q);
		p.value = p.value + s1;
		p.value = p.value + s.slice(q);
		p.selectionEnd = q + s1.length;
		p.selectionStart = p.selectionEnd;
	}
}

function o() { //……メニュー
	s = document.getElementById("pn").style.display;
	if(s == "block"){
		document.getElementById("pn").style.display = "none";
		document.getElementById("cn").style.display = "block";
		localStorage.setItem('pn',0);
	}else{
		document.getElementById("pn").style.display = "block";
		document.getElementById("cn").style.display = "none";
		localStorage.setItem('pn',1);
	}
}

function si() { //……保存
	s = p.value;
	if(s == ""){
		mp("内容がありません");
	}else{
		if(window.confirm("保存しますか？")){
			localStorage.setItem('pvalue',s);
			mp("保存しました");
		}
	}
}

function gi() { //……復帰
	s = localStorage.getItem('pvalue');
	if(s == "" || s ==null){
		mp("保存されていません");
	}else{
		if (window.confirm("復帰しますか？")) {
			s = p.value;
			p.value = localStorage.getItem('pvalue');
			if(s == ""){
				mp("復帰しました");
			}else{
				localStorage.setItem('pvalue',s);
				mp("内容を入れ替えました");
			}
		}
	}
}

function c() { //……全文コピー
	if(window.confirm("全文コピーしますか？")){
		q = p.selectionEnd;
		p.select();
		try{
			document.execCommand('copy');
			mp("コピーしました");
		}catch(e){
			alert("実行できませんでした\n" + e);
		}
		p.setSelectionRange(q,q);
	}
}

function t() { //……左端
	s = p.value;
	q = p.selectionEnd;
	if(bb && p.selectionDirection == "backward"){
		q = p.selectionStart;
	}
	
	s1 = s.slice(0,q);
	s1 = s1.split("\n");
	s1.reverse();
	s1 = ar(s1[0]); //キャレット行
	s1.reverse();
	q -= s1[0].length;
	
	if(bb){
		if(p.selectionDirection == "backward"){
			p.selectionStart = q;
		}else{
			if(q < p.selectionStart){
				p.setSelectionRange(q,p.selectionStart,"backward");
			}else{
				p.selectionEnd = q;
			}
		}
	}else{
		p.setSelectionRange(q,q);
	}
}

function m() { //……右端
	s = p.value;
	q = p.selectionEnd;
	if(bb && p.selectionDirection == "backward"){
		q = p.selectionStart;
	}
	
	s1 = s.slice(0,q);
	s1 = s1.split("\n");
	s1.reverse();
	s0 = ar(s1[0]); //行頭～キャレット
	s0.reverse();
	q1 =  q - s0[0].length //左端～キャレット
	s1 = s.slice(q1);
	s1 = s1.split("\n");
	s1 = ar(s1[0]); //左端～行末
	q1 += s1[0].length; //左端～右端
	if(q == q1 && 1 in s1){
		q1 += s1[1].length; 
	}
	q = q1;
	
	if(bb){
		if(p.selectionDirection == "backward"){
			if(q > p.selectionEnd){
				p.setSelectionRange(p.selectionEnd,q,"forward");
			}else{
				p.selectionStart = q;
			}
		}else{
			p.selectionEnd = q;
		}
	}else{
		p.setSelectionRange(q,q);
	}
}

function a() { //……文頭
	if(bb){
		if(p.selectionDirection == "backward"){
			p.selectionStart = 0;
		}else{
			p.setSelectionRange(0,p.selectionStart,"backward");
		}
	}else{
		p.setSelectionRange(0,0);
	}
	p.scrollTop = 0;
}

function l() { //……左
	if(bb){
		if(p.selectionDirection == "backward"){
				p.selectionStart--;
		}else{
			if(p.selectionStart == p.selectionEnd){
				p.selectionStart--;
				p.selectionDirection = "backward";
			}else{
				p.selectionEnd--;
			}
		}
	}else{
		p.selectionEnd--;
	}
}

function g() { //……右
	if(bb){
		if(p.selectionDirection == "backward"){
			if(p.selectionStart == p.selectionEnd){
				p.selectionEnd++;
				p.selectionDirection = "forward";
			}else{
				p.selectionStart++;
			}
		}else{
			p.selectionEnd++;
		}
	}else{
		p.selectionStart++;
	}
}

function z() { //……文末
	s = p.value;
	q = s.length;
	if(bb){
		if(p.selectionDirection == "backward"){
			p.setSelectionRange(p.selectionEnd,q,"forward");
		}else{
			p.selectionEnd = q;
		}
	}else{
		p.setSelectionRange(q,q);
	}
	p.scrollTop = p.scrollHeight;
}

function v() { //……鳩
	s = p.value;
	q = p.selectionEnd;
	p.value = s.slice(0,q);
	p.value = p.value + "♡";
	p.value = p.value + s.slice(q);
	p.selectionEnd = q + 1;
	p.selectionStart = p.selectionEnd;
}

function al(s1) { //……文字数カウント
	var s = s1.match(/[\uD800-\uDBFF][\uDC00-\uDFFF]|[^\uD800-\uDFFF]/g)||[];
	s = s.length * 2;
	s -= (s1.match(/[\x20-\x7e]/g)||[]).length
	return(s);
}

function ar(s1) { //……改行配列作成
	var s1 = s1.match(/[\uD800-\uDBFF][\uDC00-\uDFFF]|[^\uD800-\uDFFF]/g)||[];
	var s2 = 0;
	var s3 = "";
	var s4 = 0;
	var s5 = 0;
	var s6 = [""];
	var p1 = p.style.fontSize.slice(0,-2) - 0;
	var p2 = (p.style.letterSpacing.slice(0,-2) - 0) * 2;
	var p3 = (p.clientWidth - 10) * 2;
	for(s3 in s1){
		if(/[\x20-\x7e]/.test(s1[s3])){ //半角
			s4 = p1 + p2;
		}else{ //全角
			s4 = p1 + p1 + p2;
		}
		if((s2 + s4) > p3){ //あふれたら改行
			s2 = s4;
			s5++;
			s6[s5] = s1[s3];
		}else{
			s2 += s4;
			s6[s5] += s1[s3];
		}
	}
	return(s6);
}

function u() { //……上キー
	s = p.value;
	q = p.selectionEnd;
	if(bb && p.selectionDirection == "backward"){
		q = p.selectionStart;
	}
	
	s1 = s.slice(0,q);
	s1 = s1.split("\n");
	s1.reverse();
	s0 = ar(s1[0]); //キャレット行
	s1 = ar(s1[1]); //前行
	s0.reverse();
	s2 = al(s0[0]); //左端～キャレット
	s2 = Math.ceil(s2 / 2) * 2;
	if(1 in s0){ //行内で移動可能
		s3 = s0[1].match(/[\uD800-\uDBFF][\uDC00-\uDFFF]|[^\uD800-\uDFFF]/g)||[];
		for(i in s3){
			i++;
			s4 = s3.slice(0,i);
			i--;
			s4 = s4.join("");
			if(al(s4) > s2){
				s4 = s3.slice(i);
				s4 = s4.join("");
				break;
			}
			s4 = "";
		}
		q = q - s4.length - s0[0].length
	}else{
		s1.reverse();
		s3 = s1[0].match(/[\uD800-\uDBFF][\uDC00-\uDFFF]|[^\uD800-\uDFFF]/g)||[];
		for(i in s3){
			i++;
			s4 = s3.slice(0,i);
			i--;
			s4 = s4.join("");
			if(al(s4) > s2){
				s4 = s3.slice(i);
				s4 = s4.join("");
				break;
			}
			s4 = "";
		}
		q = q - s4.length - s0[0].length - 1;
	}
	
	if(bb){
		if(p.selectionDirection == "backward"){
			p.selectionStart = q;
		}else{
			if(q < p.selectionStart){
				p.setSelectionRange(q,p.selectionStart,"backward");
			}else{
				p.selectionEnd = q;
			}
		}
	}else{
		p.setSelectionRange(q,q);
	}
}

function d() { //……下キー
	s = p.value;
	q = p.selectionEnd;
	if(bb && p.selectionDirection == "backward"){
		q = p.selectionStart;
	}
	
	s1 = s.slice(0,q);
	s1 = s1.split("\n");
	s1.reverse();
	s0 = ar(s1[0]); //行頭～キャレット行
	s0.reverse();
	s2 = al(s0[0]); //左端～キャレット
	
	q -= s0[0].length //キャレット行左端以降
	s1 = s.slice(q);
	s1 = s1.split("\n");
	s0 = ar(s1[0]);
	if(1 in s0){
		s3 = s0[1].match(/[\uD800-\uDBFF][\uDC00-\uDFFF]|[^\uD800-\uDFFF]/g)||[];
		for(i in s3){
			i++;
			s4 = s3.slice(0,i);
			s4 = s4.join("");
			if(al(s4) >= s2){
				if(i == 1 && s2 == 0){
					s4 = "";
					break;
				}
				s4 = s3.slice(0,i);
				s4 = s4.join("");
				break;
			}
		}
		q = q + s4.length + s0[0].length;
	}else if(s1[1] == ""){
		q = q + s1[0].length + 1;
	}else{
		s3 = s1[1].match(/[\uD800-\uDBFF][\uDC00-\uDFFF]|[^\uD800-\uDFFF]/g)||[];
		for(i in s3){
			i++;
			s4 = s3.slice(0,i);
			s4 = s4.join("");
			if(al(s4) >= s2){
				if(i == 1 && s2 == 0){
					s4 = "";
				}
				break;
			}
		}
		q = q + s4.length + s1[0].length + 1;
	}

	if(bb){
		if(p.selectionDirection == "backward"){
			if(q > p.selectionEnd){
				p.setSelectionRange(p.selectionEnd,q,"forward");
			}else{
				p.selectionStart = q;
			}
		}else{
			p.selectionEnd = q;
		}
	}else{
		p.setSelectionRange(q,q);
	}
}

function h() { //……整形＆プレビュー
	s = p.value;
	s = s.replace(/^\n+/,"");
	s = s.replace(/\n+$/,"");
	s = s.replace(/^/gm,"　");
	s = s.replace(/([！？♡])/g,"$1　");
	s = s.replace(/　([「『！？♡』」）])/g,"$1");
	s = s.replace(/^([！？♡])/gm,"　$1");
	s = s.replace(/　$/gm,"");
	s = s.replace(/……/gm,"…");
	s = s.replace(/…/gm,"……");
	s = s.replace(/</gm,"&lt;");
	s = s.replace(/>/gm,"&gt;");
	s = s.replace(/\n/gm,"<br>");
	s = "<h1>Preview [" + s.length +"]　<button type=button onclick=\"x()\">×</button>　<button type=button onclick=\"hm()\">「</button><button type=button onclick=\"pu()\">↑</button><button type=button onclick=\"pd()\">↓</button><button type=button onclick=\"ed()\">」</button></h1><p>" + s + "</p>";
	w.innerHTML = s;
	w.style.display = "block";
}

function hm() { //……プレビューhome
	window.scrollTo(0,0);
}

function pu() { //……プレビューpageup
	s = window.innerHeight;
	s = (s -51) * -1;
	window.scrollBy(0,s);
}

function pd() { //……プレビューpagedown
	s = window.innerHeight;
	s = s -51;
	window.scrollBy(0,s);
}

function ed() { //……プレビューend
	window.scrollTo(0,document.body.scrollHeight);
}

function x() { //……プレビューを閉じる
	w.innerHTML = 0;
	w.style.display = "none";
}

function bu() { //……自動バックアップ
	s = p.value;
	if(s != ""){
			localStorage.setItem('pvalue_bu',s);
	}
//	pwc();
}

function pwc() { //……1行の文字数（全角）
	pw = p.style.fontSize.slice(0,-2) - 0;
	if(!pw){
		pw = document.getElementById("ft").value - 0;
	}
	s = p.style.letterSpacing.slice(0,-2) - 0;
	if(!s){
		s =  document.getElementById("ls").value - 0;
	}
	s = s + pw; //font-size + letter-spacing
	pw = p.clientWidth - 10; //textarea内寸からpaddingを引く
	pw = Math.floor(pw / s);
}

p = document.getElementById("pr"); //テキストエリアオブジェクト
w = document.getElementById("vw"); //プレビュー用オブジェクト
r = document.getElementById("swl"); //定型文選択用オブジェクト

s = localStorage.getItem('prows'); //行数
if(s >= 5 && s <= 20){
	document.getElementById("cr").value = s;
	p.rows = s;
}
s = localStorage.getItem('pfs'); //フォントサイズ
if(s >= 8 && s <= 39){
	document.getElementById("ft").value = s;
	p.style.fontSize = s + "px";
}else{
	p.style.fontSize = "13px";
}
s = localStorage.getItem('pls'); //字間
if(s >= 0 && s <= 9 && s != null){
	document.getElementById("ls").value = s;
	p.style.letterSpacing = s + "px";
}else{
	p.style.letterSpacing = "1px";
}
s = localStorage.getItem('plh'); //行間
if(s >= 0 && s <= 200 && s != null){
	document.getElementById("lh").value = s;
	p.style.lineHeight = s + "%";
}
pw = /^#[\da-f]{6}$/i;
s = localStorage.getItem('pfc'); //文字色
if(pw.test(s)){
	document.getElementById("fc").value = s;
	p.style.color = s;
}
s = localStorage.getItem('pbc'); //背景色
if(pw.test(s)){
	document.getElementById("bc").value = s;
	p.style.backgroundColor = s;
}
s = localStorage.getItem('pbh'); //ボタン高さ
if(s >= 11 && s <= 45){
	document.getElementById("bh").value = s;
	for (s1 = 0; s1 < 16; s1++) {
		document.getElementsByTagName("button")[s1].style.height = s + "px";
	}
	r.style.height = s + "px";
}

pwc();
s = localStorage.getItem('psc'); //定型文スイッチ
if(s){
	document.getElementById("swg").style.display = "inline";
}
document.getElementById("sc").checked = s;
s = localStorage.getItem('psw'); //定型文内容
if(s != "" && s != null){
	document.getElementById("sw").value = s;
	s = s.replace(/</g,"&lt;");
	s = s.replace(/>/g,"&gt;");
	s = s.replace(/^(.+)$/gm,"<option>$1</option>");
	r.innerHTML = s;
}

s = localStorage.getItem('pn'); //メニュー状態復帰
if(s > 0){
	document.getElementById("pn").style.display = "block";
	document.getElementById("cn").style.display = "none";
}

s = localStorage.getItem('pvalue_bu'); //自動バックアップから復帰
if(p.value == "" && s != null && s != ""){
		p.value = s;
}else{
	s = localStorage.getItem('pvalue'); //保存から復帰
	if(p.value == "" && s != null && s != ""){
		p.value = s;
	}
}

s = localStorage.getItem('wfl'); //webフォント使用状態
if(s > 0){
	p.style.fontFamily = '"emj","webnasm"';
	document.getElementById("wf").textContent = "終了";

}

bb = 0; //範囲選択モード初期値：オフ


//--></script>

</body>
</html>
